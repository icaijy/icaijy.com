{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ problem.title }} - {% trans "OJ" %}{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="title">{{ problem.title }}</h1>
  <div class="mb-3 d-flex gap-2">
      <a href="{% url 'problem_speedrun' problem.id %}" class="btn btn-outline-success">
          {% trans "Go to Speedrun" %}
      </a>
      <a href="{% url 'problem_leaderboard' problem.id %}" class="btn btn-outline-primary">
          {% trans "View Leaderboard" %}
      </a>
  </div>
  <!-- Problem Info Card -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <p class="lead">{{ problem_content|safe }}</p>
      <p class="text-muted">
        <strong>{% trans "Time Limit:" %}</strong> {{ problem.time_limit }}s
        &nbsp; | &nbsp;
        <strong>{% trans "Memory Limit:" %}</strong> {{ problem.memory_limit }} MB
      </p>


    </div>
  </div>

  <!-- Practice Editor Card -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <h5 class="mb-3">{% trans "Practice Mode" %}</h5>

      <form method="post" id="submission-form" novalidate>
        {% csrf_token %}
        <div class="mb-2 d-flex gap-2">
          <select name="language" class="form-select w-auto" id="lang-select">
            <option value="cpp">C++</option>
            <option value="py">Python</option>
          </select>
          <button type="submit" class="btn btn-primary">{% trans "Submit" %}</button>
        </div>

        <!-- Monaco Editor Container -->
        <div id="practice-editor" style="height: 400px; border: 1px solid #ccc;"></div>

        <!-- Hidden textarea to store Monaco content -->
        <textarea id="code-hidden" name="code" hidden></textarea>
        <input type="hidden" name="elapsed_time" value="-1">
      </form>
    </div>
  </div>
</div>

<!-- Monaco Editor Loader -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs/loader.js"></script>
<script>
(function(){
  const langSelect = document.getElementById("lang-select");
  const form = document.getElementById("submission-form");
  const codeHidden = document.getElementById("code-hidden");

  require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs' }});

  require(['vs/editor/editor.main'], function () {
    let editor = monaco.editor.create(document.getElementById('practice-editor'), {
      value: '',
      language: 'cpp',
      theme: 'vs',
      automaticLayout: true,
      fontSize: 14,
      minimap: { enabled: false }
    });

    langSelect.addEventListener('change', function(){
      const newLang = (this.value === 'cpp') ? 'cpp' : 'python';
      monaco.editor.setModelLanguage(editor.getModel(), newLang);
    });

    form.addEventListener('submit', function(){
      codeHidden.value = editor.getValue();
    });
  });
})();
</script>
{% endblock %}
